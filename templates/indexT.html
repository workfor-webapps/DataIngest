{% extends 'base.html' %}
{% block head %}
<h2>Table 1</h2>
{% endblock %}
<br>
{% block body %}


<!-- <div class="jumbotron"> -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-4">
                <strong>{{title}}</strong>
                <br>
                <br>

                <p>Lacerenza CN, Reyes DL, Marlow SL, Joseph DL, Salas E.</p>

                <p><i>J Appl Psychol. 2017 Dec;102(12):1686-1718.</i></p>

                <a href="https://doi.org/{{DOI}}">doi: {{DOI}} </a><img src="../static/link-256.webp" width="15">
                <br>
                <br>
                <a href="/showPDF">Open PDF </a><img src="../static/link-256.webp" width="15">

                <hr>

            </div>
            <div class="col-6">

               <form action="/submit_form">  <!-- FOAD replace this with a flask endpoint-->
                
                   <div class="row form-group">
                       <div class="col text-right ">
                           <label for="ref_con"><b>REFERENCE CONCEPT</b></label>

                       </div>
                       <div class="col">
                           <select class="form-control" id="ref_con" aria-label=" ">
                               <option selected>Leadership </option>
                               <option value="1">training</option>
                               <option value="2">effectiveness</option>
                               <option value="3">Other</option>
                           </select>
                       </div>
                       

                   </div>

                   <div class="row form-group">
                       <div class="col text-right">
                           <label for="con_cat"><b>CONCEPT CATEGORY</b></label>

                       </div>
                       <div class="col">
                           <select class="form-control" id="con_cat" aria-label=" ">
                               <option selected>Leadership </option>
                               <option value="1">One</option>
                               <option value="2">Two</option>
                               <option value="3">Three</option>
                           </select>
                       </div>
                   </div>
                   <div class="row form-group">
                       <div class="col text-right">
                           <label for="con_dir"><b>CONCEPT DIRECTION</b></label>

                       </div>
                       <div class="col">
                           <select class="form-control" id="con_dir" aria-label=" ">
                               <option selected>Outcome</option>
                               <option value="1">One</option>
                               <option value="2">Two</option>
                               <option value="3">Three</option>
                           </select>
                       </div>
                   </div>
                   <div class="row form-group">
                       <div class="col text-right">
                           <label for="eff_type"><b>EFFECT TYPE</b></b></label>

                       </div>
                       <div class="col">
                           <select class="form-control" id="eff_type" aria-label=" ">
                               <option selected>Correlation</option>
                               <option value="1">One</option>
                               <option value="2">Two</option>
                               <option value="3">Three</option>
                           </select>
                       </div>
                   </div>

<!--                    <input class= "btn btn-outline-success" type="submit" value="Submit">-->
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-5 "> <!-- This div is for image and magnifier-->
                <style>
                    * {box-sizing: border-box;}
                    
                    .img-magnifier-container {
                      position:relative;
                    }
                    
                    .img-magnifier-glass {
                      position: absolute;
                      border: 3px solid #000;
                      border-radius: 50%;
                      cursor: auto;
                      /*Set the size of the magnifier glass:*/
                      width: 100px;
                      height: 100px;
                    }
                </style>
                <!-- <img id = "pageImage" class="img-fluid shadow-lg p-3 mb-5 bg-white" src='../static/capture.png'> -->
                <div class="img-magnifier-container">
                    <img id="pageImage" class="img-fluid shadow-lg p-3 mb-5 bg-white" src="../static/capture.png">
                </div>
            </div>

            

            <div class="col-7">
                <div class="row">
                    <div class="col-10">
                        <form class="form-inline" >
                            <label for="concept" class="mr-sm-2">CONCEPT CATEGORY :</label>
                            <input type="concept" class="form-control mb-2 mr-sm-2" placeholder="concept" id="concept">
                            <div class="form-check mb-2 mr-sm-2"></div>
                            <a class="btn btn-info btn-sm" onclick="applyAll()">Apply to all</a>
                            <div class="form-check mb-2 mr-sm-2"></div>
                            <a class="btn btn-info btn-sm" onclick="ClearAll()">Clear all</a>
                        </form>  
                    </div>
                    <div class="col-2">
                        <h4>
                            <div style="text-align: right;">Table {{table_num}}/5</div>
                        </h4>

                        <br>
                    </div>
                </div>
                
                <div class="row">
                
                {% if table_num==1 %}
                {%include 'table_temp.html'%}
                {% endif  %}

                {%if table_num==2 %}
                {%   include 'table_temp1.html' %}
                {% endif  %}
                

                </div>
               <div class="row">
                    <div class="col-4">
                        <a style="text-align: center;" class="btn btn-light btn-sm" onclick="add_bott()"> + Add new row </a>

                    </div>
                    <div class="col-8">
                        <a class="btn btn-danger btn-lg" onclick="Ignore()">Ignore</a>
                        
                        <a class="btn btn-success btn-lg" onclick="html2json()">Accept</a>
                    </div>
                </div>


            </div>
        </div>

    </div>
<!-- </div> -->

<script>
    function html2json() {
        var $table = $("table")
        rows = [],
            header = [];

        $table.find("thead th").each(function () {
            header.push($(this).html());
        });

        $table.find("tbody tr").each(function () {
            var row = {};

            $(this).find("td").each(function (i) {
                var key = header[i],
                    value = $(this).html();

                row[key] = value;
            });

            rows.push(row);
        });

    //construct an HTTP request
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/post_json', true);
    xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

    // send the collected data as JSON
    xhr.send(JSON.stringify(rows));

    console.log(JSON.stringify(rows))
    
    // reload page
    var url = window.location.href;    
    if (url.indexOf('?') > -1){
        
    }else{
        url += '?table=2'
    }
    //window.location.href = url;
    return JSON.stringify(rows);
    }

</script>


<script src="/static/css/bootstable.js"></script>
<script>
//apply
$("#pdf").SetEditable();
function add_bott() {
        rowAddNewAndEdit('pdf');
  };


function Ignore() {
    var json = '{';
    console.log("Table Deleted")
    return 200;
  };


function applyAll() {
    var x = document.getElementById("concept").value; 
    var table = document.getElementById("pdf");
    var r = document.getElementById("pdf").rows.length;
    for (i=1; i<r; i++) {
        table.rows[i].cells[0].innerHTML = x
    }
    
    return false

};

function ClearAll() {
    
    var table = document.getElementById("pdf");
    var r = document.getElementById("pdf").rows.length;
    for (i=1; i<r; i++) {
        table.rows[i].cells[0].innerHTML = ""
    }
    
    return false

};
function GetURLParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
};

// Java image magnifier function 
function magnify(imgID, zoom) {
  var img, glass, w, h, bw;
  img = document.getElementById(imgID);
  /*create magnifier glass:*/
  glass = document.createElement("DIV");
  glass.setAttribute("class", "img-magnifier-glass");
  /*insert magnifier glass:*/
  img.parentElement.insertBefore(glass, img);
  /*set background properties for the magnifier glass:*/
  glass.style.backgroundImage = "url('" + img.src + "')";
  glass.style.backgroundRepeat = "no-repeat";
  glass.style.backgroundSize = (img.width * zoom) + "px " + (img.height * zoom) + "px";
  bw = 3;
  w = glass.offsetWidth / 2;
  h = glass.offsetHeight / 2;
  /*execute a function when someone moves the magnifier glass over the image:*/
  glass.addEventListener("mousemove", moveMagnifier);
  img.addEventListener("mousemove", moveMagnifier);
  /*and also for touch screens:*/
  glass.addEventListener("touchmove", moveMagnifier);
  img.addEventListener("touchmove", moveMagnifier);
  function moveMagnifier(e) {
    var pos, x, y;
    /*prevent any other actions that may occur when moving over the image*/
    e.preventDefault();
    /*get the cursor's x and y positions:*/
    pos = getCursorPos(e);
    x = pos.x;
    y = pos.y;
    /*prevent the magnifier glass from being positioned outside the image:*/
    if (x > img.width - (w / zoom)) {x = img.width - (w / zoom);}
    if (x < w / zoom) {x = w / zoom;}
    if (y > img.height - (h / zoom)) {y = img.height - (h / zoom);}
    if (y < h / zoom) {y = h / zoom;}
    /*set the position of the magnifier glass:*/
    glass.style.left = (x - w) + "px";
    glass.style.top = (y - h) + "px";
    /*display what the magnifier glass "sees":*/
    glass.style.backgroundPosition = "-" + ((x * zoom) - w + bw) + "px -" + ((y * zoom) - h + bw) + "px";
  }
  function getCursorPos(e) {
    var a, x = 0, y = 0;
    e = e || window.event;
    /*get the x and y positions of the image:*/
    a = img.getBoundingClientRect();
    /*calculate the cursor's x and y coordinates, relative to the image:*/
    x = e.pageX - a.left;
    y = e.pageY - a.top;
    /*consider any page scrolling:*/
    x = x - window.pageXOffset;
    y = y - window.pageYOffset;
    return {x : x, y : y};
  }
};

</script>

<script>
    /* Initiate Magnify Function
    with the id of the image, and the strength of the magnifier glass:*/
    magnify("pageImage", 3);
</script>



{% endblock %}